{{extend "layout.html"}}
<script type="text/javascript" src="http://maps.google.co.jp/maps/api/js?sensor=false"></script>
<script type="text/javascript">
  var SJP = {};
  SJP.kmlUrl = {
{{if deployment_settings.frontpage.kml:}}
  {{counter = 0}}
  {{for kml in deployment_settings.frontpage.kml:}}
    {{counter += 1}}
    {{=kml["name"]}}: '{{=kml["url"]}}'{{if counter != len(deployment_settings.frontpage.kml):}},{{pass}}
  {{pass}}
{{pass}}
  };
</script>
<script type="text/javascript">
 $(document).ready(function() {
  var latlng = new google.maps.LatLng(39.095963, 140.778809);
  var myOptions = {
    zoom: 8,
    center: latlng,
    mapTypeControl: true,
    mapTypeControlOptions: {style: google.maps.MapTypeControlStyle.DROPDOWN_MENU},
    mapTypeId: google.maps.MapTypeId.ROADMAP
  };
  var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);

  var kmlLayer = {};
 
  $('input:checkbox').click(function() {
   var name = $(this).attr('name');
   if ($(this).attr('checked')) {
    if (SJP.kmlUrl[name]) {
     if (!kmlLayer[name]) {
      kmlLayer[name] = new google.maps.KmlLayer(SJP.kmlUrl[name], {preserveViewport: true});
     }
     kmlLayer[name].setMap(map);
    }
   } else if(kmlLayer[name]) {
     kmlLayer[name].setMap(null);
   }
  });

  var data = {
   iDisplayStart: 0,
   iDisplayLength: 5,
   iSortingCols: 1,
   iSortCol_0: 2,
   sSortDir_0: 'desc'
  };
  
  $.ajaxSetup({
   jsonp: null,
   jsonpCallback: null
  });

  $.getJSON(S3.Ap + '/req/req.aaData', data, function(json) {
     $.each(json.aaData, function(index, record) {
      $("#tbody_requests").append($("<tr><td>" + record[0].replace('.aaData','').replace(/>\d+</,'>'+record[1]+'<') + "</td><td>" + record[2] + "</td><td>" + record[3] + "</td></tr>"));
     })
  });

  // Change register/login links to avoid page reload, make back button work.
  $('#sign-up-now').attr('href', '#register');
  $('#login-now').attr('href', '#login');

  $('#sign-up-now').click(function() {
     $('#login_form').addClass('hide');
     $('#register_form').removeClass('hide');
  });
  $('#login-now').click(function() {
     $('#register_form').addClass('hide');
     $('#login_form').removeClass('hide');
  });
});
</script>
<style type="text/css">
.menu_sit {
 width:50%
}
.menu_center {
 width:5%;
}
.menu_res {
 width:45%;
}
ul.menu li
{
 float: left;
 list-style-type: none;
}
.map_control {
 clear:left;
 padding-top:10px;
}
#map_canvas {
 height:480px;
 width:100%;
}
</style>

<div id='home'>
<h2>{{=title}}</h2>

 <div class="menu_box">
  <div class="menu_div menu_sit">
   <ul class="menu">
    <li>
     <a class="menu-box-l" href="/{{=request.application}}/cr/shelter">
      <div class="menu-box-r">{{=T('Shelters')}}</div>
     </a>
    </li>
    <li>
     <a class="menu-box-l" href="/{{=request.application}}/pr/presence">
      <div class="menu-box-r">{{=T('Presence Condition')}}</div>
     </a>
    </li>
   </ul>
   <div class="map_control">
    {{=T('Show on map')}}
    <input name="shelter" type="checkbox"/>{{=T('Shelters')}}
    <input name="hospital" type="checkbox"/>{{=T('Hospital')}}
   </div>
   <div id="map_canvas"></div>
  </div>
  <div class="menu_div menu_center"></div>
  <div class="menu_div menu_res">
   <h3>{{=T('Requests')}}</h3>
   <table id="table_requests" class="display">
    <thead>
     <tr><th></th>&nbsp;<th>{{=T('Date Requested')}}</th><th>{{=T('Date Required')}}</th></tr>
    </thead>
    <tbody id="tbody_requests"></tbody>
   </table>
   <div style="text-align: right;">
    <a href="/{{=request.application}}/req/req">{{=T('List Requests')}}</a>
   </div>
   <!-- Request Items -----------------------------
   <h3>{{=T('Request Items')}}</h3>
   <table id="table_request_items" class="display">
    <thead>
     <tr><th></th>&nbsp;<th>{{=T('Date Requested')}}</th><th>{{=T('Date Required')}}</th></tr>
    </thead>
    <tbody id="tbody_request_items"></tbody>
   </table>
   <div style="text-align: right;">
    <a href="/{{=request.application}}/req/req_item">{{=T('List Request Items')}}</a>
   </div>
    -->
  </div>
 </div>
</div>

<div id='about'>
    <p>
{{if deployment_settings.frontpage.about:}}
  {{for about in deployment_settings.frontpage.about:}}
    {{if 'href' in about:}}<a href="{{=about['href']}}" target="_blank">{{pass}}{{=about['text']}}{{if 'href' in about:}}</a><br/>{{pass}}
  {{pass}}
{{pass}}
    </p>
{{if 2 not in session.s3.roles:}}
    <p>
    {{=T('If you would like to help, then please')}}
    <a class="action-lnk" href="user/login" id="login-now">{{=T('Login')}}</a>
  {{if self_registration and not registered:}}
    <a class="action-lnk" href="user/register" id="sign-up-now" >{{=T('Sign-up for Account')}}</a>
  {{pass}}
    </p>
{{pass}}
    <p>&nbsp;</p>
</div>

{{if 2 not in session.s3.roles:}}
    {{if not self_registration or registered:}}
        <div id='login_form' class='hide'>
            {{=login_div}}
            {{include "auth/_login.html"}}
        </div>
    {{pass}}
    {{if self_registration:}}
        <div id='register_form' class='hide'>
            {{=register_div}}
            {{include "auth/_register.html"}}
        </div>
    {{pass}}
    {{if self_registration and not registered:}}
      <div id='login_form' class='hide'>
        {{=login_div}}
        {{include "auth/_login.html"}}
      </div>
    {{pass}}
{{pass}}

{{if deployment_settings.frontpage.rss:}}
  {{include "rssviewer.html"}}
{{pass}}